name: Telegram Notifier
on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Verify Telegram connection
        run: |
          echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram API..."
          curl -s "https://api.telegram.org/bot7715307360:AAFvEpydlOSPY_pGT51AbExRAaECg-1P06Q/getMe" | jq
          echo ""

      - name: Send simplest possible message
        run: |
          curl -v -X POST \
          "https://api.telegram.org/bot7715307360:AAFvEpydlOSPY_pGT51AbExRAaECg-1P06Q/sendMessage" \
          -H "Content-Type: application/json" \
          -d '{
            "chat_id": "5615087670",
            "text": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ GitHub Actions"
          }'

      - name: Show environment variables
        run: |
          echo "GITHUB_REPOSITORY=$GITHUB_REPOSITORY"
          echo "GITHUB_ACTOR=$GITHUB_ACTOR"
          echo "GITHUB_REF=$GITHUB_REF"
          echo "GITHUB_SHA=$GITHUB_SHA"

      - name: Send final message
        run: |
          COMMITS=$(git log --pretty=format:'%h - %an: %s' -n 1)
          curl -X POST \
          "https://api.telegram.org/bot7715307360:AAFvEpydlOSPY_pGT51AbExRAaECg-1P06Q/sendMessage" \
          -H "Content-Type: application/json" \
          -d '{
            "chat_id": "5615087670",
            "text": "üìå –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: '"$GITHUB_REPOSITORY"'\n\n–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç:\n'"$COMMITS"'\n\n–ê–≤—Ç–æ—Ä: '"$GITHUB_ACTOR"'",
            "parse_mode": "HTML"
          }'
