name: Telegram Notifier
on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Get commit info
        id: commits
        run: |
          echo "COMMITS=$(git log --pretty=format:'%h - %an: %s' HEAD^..HEAD | sed 's/\"/\\"/g')" >> $GITHUB_OUTPUT
          echo "VERSION=$(git describe --tags --abbrev=0 2>/dev/null || echo '0.0.1')" >> $GITHUB_OUTPUT
      
      - name: Send to Telegram
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          curl -X POST \
          -H "Content-Type: application/json" \
          -d '{
            "chat_id": "'"$TELEGRAM_CHAT_ID"'",
            "text": "üìå *–ù–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤* [${GITHUB_REPOSITORY}](https://github.com/${GITHUB_REPOSITORY})\n\n*–ö–æ–º–º–∏—Ç—ã:*\n```\n${{ steps.commits.outputs.COMMITS }}\n```\n\n*–ê–≤—Ç–æ—Ä:* ${GITHUB_ACTOR}\n*–í–µ—Ä—Å–∏—è:* ${{ steps.commits.outputs.VERSION }}",
            "parse_mode": "MarkdownV2",
            "disable_web_page_preview": true
          }' \
          "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage"
