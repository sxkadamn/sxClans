name: Telegram Notifier
on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Get commit info
        id: commits
        run: |
          echo "COMMITS=$(git log --pretty=format:'%h - %an: %s' HEAD^..HEAD | sed 's/[][_*`]/\\&/g')" >> $GITHUB_OUTPUT
          echo "VERSION=$(git describe --tags --abbrev=0 2>/dev/null || echo 'dev')" >> $GITHUB_OUTPUT
      
      - name: Send to Telegram
        run: |
          MESSAGE=$(cat <<EOF
          ðŸ“Œ ÐÐ¾Ð²Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² $GITHUB_REPOSITORY

          ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚Ñ‹:
          ${{ steps.commits.outputs.COMMITS }}

          ÐÐ²Ñ‚Ð¾Ñ€: $GITHUB_ACTOR
          Ð’ÐµÑ€ÑÐ¸Ñ: ${{ steps.commits.outputs.VERSION }}
          EOF
          )

          curl -X POST \
          -H "Content-Type: application/json" \
          -d '{
            "chat_id": "5615087670",
            "text": "'"$MESSAGE"'",
            "parse_mode": "Markdown"
          }' \
          "https://api.telegram.org/bot7715307360:AAFvEpydlOSPY_pGT51AbExRAaECg-1P06Q/sendMessage"
