name: Telegram Notifier
on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Prepare message
        id: prepare
        run: |
          # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°Ñ…
          COMMITS=$(git log --pretty=format:'%h - %an: %s' HEAD^..HEAD | sed 's/"/\\"/g')
          
          # Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ JSON-ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
          MESSAGE=$(printf '{
            "chat_id": "5615087670",
            "text": "ðŸ“Œ ÐÐ¾Ð²Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² %s\n\nÐšÐ¾Ð¼Ð¼Ð¸Ñ‚Ñ‹:\n%s\n\nÐÐ²Ñ‚Ð¾Ñ€: %s\nÐ’ÐµÑ€ÑÐ¸Ñ: dev",
            "parse_mode": "Markdown"
          }' "$GITHUB_REPOSITORY" "$COMMITS" "$GITHUB_ACTOR")
          
          echo "MESSAGE=${MESSAGE}" >> $GITHUB_OUTPUT
          echo "Generated message:"
          echo "$MESSAGE"

      - name: Send to Telegram
        run: |
          curl -v -X POST \
          -H "Content-Type: application/json" \
          -d '${{ steps.prepare.outputs.MESSAGE }}' \
          "https://api.telegram.org/bot7715307360:AAFvEpydlOSPY_pGT51AbExRAaECg-1P06Q/sendMessage"
