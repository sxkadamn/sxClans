- name: Send to Telegram
  env:
    TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
  run: |
    ESCAPED_TEXT=$(sed -e 's/\*/\\*/g' -e 's/_/\\_/g' -e 's/\[/\\[/g' -e 's/\]/\\]/g' -e 's/(/\\(/g' -e 's/)/\\)/g' <<< "${{ steps.ai_analysis.outputs.result }}")

    JSON_PAYLOAD=$(jq -n \
      --arg chat_id "5615087670" \
      --arg text "🤖 *AI Анализ изменений*:\n\n$ESCAPED_TEXT\n\n🔗 *Коммит*: https://github.com/${{ github.repository }}/commit/${{ github.sha }}" \
      '{
        chat_id: $chat_id,
        text: $text,
        parse_mode: "MarkdownV2",
        disable_web_page_preview: true
      }')

    curl -X POST \
      -H "Content-Type: application/json" \
      -d "$JSON_PAYLOAD" \
      "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage"
