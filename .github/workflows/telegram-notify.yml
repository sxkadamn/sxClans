name: Telegram Notify
on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Prepare message
        id: prepare
        run: |
          COMMIT_MSG=$(git log -1 --pretty=format:'%h - %s')
          
          MESSAGE_JSON=$(jq -n \
            --arg repo "$GITHUB_REPOSITORY" \
            --arg commit "$COMMIT_MSG" \
            --arg actor "$GITHUB_ACTOR" \
            --arg sha "$GITHUB_SHA" \
            '{
              "chat_id": "5615087670",
              "text": ("ðŸ“Œ New push to " + $repo + 
                      "\nCommit: " + $commit + 
                      "\nAuthor: " + $actor + 
                      "\nLink: https://github.com/" + $repo + "/commit/" + $sha),
              "parse_mode": "HTML"
            }')
          
          echo "MESSAGE_JSON=${MESSAGE_JSON}" >> $GITHUB_OUTPUT
          echo "Generated message:"
          echo "$MESSAGE_JSON" | jq -r '.text'

      - name: Send to Telegram
        run: |
          curl -v -X POST \
          -H "Content-Type: application/json" \
          -d '${{ steps.prepare.outputs.MESSAGE_JSON }}' \
          "https://api.telegram.org/bot7715307360:AAFvEpydlOSPY_pGT51AbExRAaECg-1P06Q/sendMessage"
