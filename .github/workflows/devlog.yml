name: Devlog to Telegram

on:
  push:
    branches: [ main ]

jobs:
  send-devlog:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Send to Telegram
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
          COMMITS=$(git log --pretty=format:"üîπ %h - %an: %s" HEAD^..HEAD)
          REPO_URL=$(git remote get-url origin | sed 's/\.git$//')
          MESSAGE="üìå *–ù–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ sxClans*:\n$COMMITS\n\nüîó [–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π]($REPO_URL)"

          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
          curl -s -X POST \
            -H "Content-Type: application/json" \
            -d "{
              \"chat_id\":\"$CHAT_ID\",
              \"text\":\"$MESSAGE\",
              \"parse_mode\":\"MarkdownV2\",
              \"disable_web_page_preview\":true
            }" \
            "https://api.telegram.org/bot$BOT_TOKEN/sendMessage"
